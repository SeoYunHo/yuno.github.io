---
layout: post
title: Flux 아키텍처의 흐름
date: 2017-10-10
excerpt: "Flux 아키텍처에 대해서 알아봅시다"
tags: [js, post, react, architecture, flux]
comments: true
---

저번 포스팅 때 말씀드렸다 싶이 이번에는 MVC와 Flux 아키텍처에 대해서 알아봅시다.

**Flux 아키텍처에 대해서 설명드리기 전에 Flux 아키텍처가 나오게된 이유가 있겠죠??**

기존의 방식이 어떠한 문제가 있어서 나오게 되었는지 알아봅시다.

##기존의 문제점

Flux와 React는 Facebook이 가지고 있었던 **특정한 문제점**들을 해결하기 위해서 개발되었습니다.

그 문제점은 바로 페이스북의 알림 버그 입니다.

페이스북 메시지 아이콘에 알림이 떠 있지만, 그 메시지 아이콘을 클릭해서 들어가보면 아무런 메시지가 없던 적이 있었을 것입니다.

**이러한 문제는 왜 나타나는 것일까요??**

이전에는 MVC 아키텍처를 이용하기 때문에 데이터를 가지고 있는 모델이 뷰 레이어로 데이터를 보냅니다.

이런 식으로 데이터를 주고 받다보니, 의존성 문제 때문에 모델이 다른 모델을 업데이트해야할 때도 있습니다.

그 외에도, 아주 많은 **업데이트가 일어나기 뒤섞여서 꼬이게 됩니다**. 

### 해결 방법

그렇다면 이러한 문제를 해결하는 방법은 무엇일까요??

바로 **단방향 데이터 흐름**입니다.

Facebook은 전에 말했던 문제를 해결하기 위해서 데이터를 단방향으로만 흐르게하는 **Flux 아키텍처**를 만들었습니다.

![flux](../img/flux_process.png)

위의 그림은 Flux의 전반적인 큰 그림을 보여주고 있습니다.

이해가 안되신다면 아래의 Flux에 대한 설명을 이해하시고 다시 보시길 바랍니다.

**그럼 이제 본격적으로 Flux 아키텍처에 대해서 알아보도록 하겠습니다**

## Flux

Flux에 대해서 조금 더 쉽게 이해하기 위해서 시스템을 캐릭터로 나누어 보겠습니다.

### 1. 액션 생성자

모든 변경사항과 사용자와의 상호작용을 할 때 거쳐야하는 액션의 생성을 담당하고 있다. 

Flux에서 어플리케이션의 상태를 업데이트하고 싶을 때는 **액션을 생성**해야합니다.

액션 생성자가 액션 메시지를 생성하면 디스패치에 이를 전달합니다.

### 2. 디스패쳐

디스패쳐는 액션과 스토어를 연결시켜주는 역할을 한다고 생각하면 이해하기 쉽습니다.

이 처리는 **동기적으로 실행**되어서 위쪽에서 이야기했던 문제점을 해결할 수 있습니다.

만약 스토어들 사이에 의존성이 있어서 하나를 다른 것보다 먼저 업데이트를 해야한다면, waitFor()를 사용해서 처리할 수 있습니다.

**Flux의 디스패쳐는 다른 아키텍처들과는 조금 차이를 보입니다.** 

그것은 바로 액션 타입과는 관계없이 등록된 **모든 스토어로 보낸다**는 것입니다. 

 다시말해서, 스토어가 특정 액션만 구독하지 않고 모든 액션을 받은 뒤 처리여부를 결정한다는 이야기입니다.

 ***구독 : 스토어가 '나는 이런 액션만 받겠어!!'**

### 3. 스토어

스토어는 애플리케이션 내의 모든 상태와 그와 관련된 로직을 가지고 있습니다.


상태 변경은 반드시 스토어에 의해서 업데이트 해야되며, 상태 변경을 위한 요청을 스토어에 직접 보낼 순 없습니다. 

스토어에는 접근자(getter)는 있지만, 설정자(setter)는 존재하지 않으므로, 액션 생성자를 거쳐서 와야합다.

다시 말해서, **정해진 절차를 거쳐야만 상태를 변경할 수 있다는 것입니다.**

위에서도 설명했듯이, 만약 스토어가 디스패쳐에 등록되어 있다면, 모든 액션을 받습니다. 

스토어에서는 switch를 이용해서 액션을 구별하고 액션에 따른 처리를 해줍니다.

만약 스토어에서 상태 변경이 완료가 되면, 변경 이벤트를 발생시킵니다.

이를 통해서 뷰는 상태가 변경되었다는 것을 알게 됩니다,

### 4, 컨트롤러 뷰, 뷰

뷰는 누구나 알다싶이 상태를 가져오고 유저에게 보여주고 입력받을 화면을 렌더링합니다.

**그렇다면 컨트롤러 뷰는 무엇일까?**

컨트롤러 뷰는 변경 이벤트를 받으면, 자신의 아래에 있는 모든 뷰에게 새로운 상태를 넘겨주는 역할을 합니다.


### 동작 순서

#### 준비

애플리케이션이 초기화 될 때 한번의 준비 과정을 거칩니다.

이 과정에서 스토어는 디스패쳐에 컨트롤러 뷰에게 최신 상태를 전달하고,

이를 받은 컨트롤러 뷰는 렌더링을 위해서 모든 자식 뷰에게 넘겨 줍니다.

#### 실제 데이터의 흐름

1. 뷰는 사용자가 입력한 정보를 가지고 액션을 만들라고 액션 생성자에게 전달합니다.

2. 액션 생성자는 액션을 만들고 이를 디스패쳐에 전달합니다.

3. 디스패쳐는 들어온 액션을 순서대로 해당하는 스토어에 전달합니다. 이때 말씀드렸다 싶이 스토어는 모든 액션을 받지만, 필요한 액션만 골라서 처리합니다.

4. 상태가 변경이 되면 스토어는 컨트롤러뷰에게 변경 이벤트를 전달합니다.

5. 컨트롤러 뷰는 최신 상태를 받아 오고 이를 모든 뷰에 전달해서 렌더링을 하라고 전달합니다.

여기까지가 Flux 아키텍쳐의 흐름입니다. 


## 마무리

지금까지 Flux 아키텍처에 대해서 알아보았습니다.

어떠셨나요 재미있으셨나요?

다음 포스팅은 redux에 대해서 설명드리도록 하겠습니다.

그럼 좋은 하루 되시길 바랍니다 :)

### 참고

```
flux 카툰 안내서: https://bestalign.github.io/2015/10/06/cartoon-guide-to-flux/\

블로그에서 Flux를 이해할 때 시스템을 캐릭터로 나누어서 설명한 것이 인상 깊어서 참고했습니다.

해당 블로그에 가시면 좋은 정보 많이 있습니다.
```
